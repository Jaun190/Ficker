<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Registrieren – GrowEmpire</title>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: url('./assets/dashboard.png') no-repeat center center fixed;
      background-size: cover;
      color: #00ff88;
      padding: 2rem;
      text-align: center;
    }
    .form {
      background-color: rgba(0,0,0,0.8);
      padding: 2rem;
      border-radius: 12px;
      max-width: 400px;
      margin: 0 auto;
      box-shadow: 0 0 12px #00ff88;
    }
    input[type="email"], input[type="password"], input[type="text"] {
      width: 100%;
      padding: 10px;
      margin: 0.5rem 0;
      border-radius: 6px;
      border: none;
      font-size: 1rem;
    }
    button {
      padding: 12px 24px;
      background-color: #00ff88;
      border: none;
      color: black;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 1rem;
    }
    .agb-hinweis {
      font-size: 0.9rem;
      margin-top: 1rem;
    }
    .agb-hinweis a {
      color: #00ff88;
      text-decoration: underline;
      cursor: pointer;
    }
    .popup {
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      width: 100vw;
      background: rgba(0,0,0,0.9);
      color: white;
      display: none;
      justify-content: center;
      align-items: center;
      padding: 2rem;
    }
    .popup-content {
      background: black;
      border: 2px solid #00ff88;
      padding: 2rem;
      border-radius: 8px;
      max-height: 80vh;
      overflow-y: auto;
      max-width: 600px;
      text-align: left;
    }
    .popup button {
      background: red;
      color: white;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <div class="form">
    <h2>Registrieren</h2>
    <input type="text" id="username" placeholder="Benutzername" required />
    <input type="email" id="email" placeholder="E-Mail" required />
    <input type="password" id="password" placeholder="Passwort" required />
    <label>
      <input type="checkbox" id="agbCheckbox" />
      Ich akzeptiere die <a onclick="openAGB()">Allgemeinen Geschäftsbedingungen</a>
    </label>
    <br />
    <button onclick="register()">Registrieren</button>
  </div>

  <div class="popup" id="agbPopup">
    <div class="popup-content">
      <h2>Allgemeine Geschäftsbedingungen</h2>
      <p>
        Willkommen bei GrowEmpire. Durch das Erstellen eines Accounts erklärst du dich mit folgenden Bedingungen einverstanden:
        <br /><br />
        1. Die Nutzung dieser Plattform erfolgt auf eigene Verantwortung.<br />
        2. Es besteht keine Garantie auf Gewinne, auch wenn potenzielle Erträge ausgewiesen werden.<br />
        3. Alle Erträge und Pflanzensimulationen sind rein virtuell und dienen ausschließlich der Teilnahme am System.<br />
        4. Die Lizenzprodukte sind symbolische digitale Zugänge ohne physische Gegenleistung.<br />
        5. Auszahlungen erfolgen nur, wenn die im System festgelegten Bedingungen (z. B. Reinvest oder Werbung) erfüllt sind.<br />
        6. Nutzer verpflichten sich, nur echte, eigene E-Mail-Adressen zu verwenden.<br />
        7. GrowEmpire behält sich das Recht vor, Accounts zu sperren oder zu prüfen, wenn betrügerisches Verhalten vermutet wird.<br /><br />
        Diese Plattform ist kein Anlageprodukt im rechtlichen Sinne. Der „Ertrag“ entsteht durch Teilnahme an virtuellen Wachstumszyklen. Durch Kauf und Reinvest erhältst du Zugang zu simulierten Wachstumseinheiten mit möglichen Rückvergütungen, wenn die Bedingungen erfüllt sind.<br /><br />
        Änderungen dieser AGB sind jederzeit möglich. Bitte lies regelmäßig nach oder kontaktiere unseren Support.
      </p>
      <button onclick="closeAGB()">Schließen</button>
    </div>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const ref = urlParams.get('ref');

    function openAGB() {
      document.getElementById('agbPopup').style.display = 'flex';
    }

    function closeAGB() {
      document.getElementById('agbPopup').style.display = 'none';
    }

    async function register() {
      const email = document.getElementById('email').value;
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      const agbChecked = document.getElementById('agbCheckbox').checked;

      if (!email || !password || !username) {
        alert('Bitte alle Felder ausfüllen.');
        return;
      }
      if (!agbChecked) {
        alert('Du musst die AGB akzeptieren.');
        return;
      }

      // Supabase Registrierung
      const res = await fetch('https://afquciketcteqqynucet.supabase.co/auth/v1/signup', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFmcXVjaWtldGN0ZXFxeW51Y2V0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE4NzQxODYsImV4cCI6MjA2NzQ1MDE4Nn0.Mg247BH4XribwIICKLHu1IUCX50nbSdmK34JniLBPzY'
        },
        body: JSON.stringify({ email, password })
      });

      const data = await res.json();

      if (data.user) {
        localStorage.setItem("user_email", email);
        localStorage.setItem("username", username);

        if (ref) {
          await fetch('https://afquciketcteqqynucet.supabase.co/rest/v1/referrals', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFmcXVjaWtldGN0ZXFxeW51Y2V0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE4NzQxODYsImV4cCI6MjA2NzQ1MDE4Nn0.Mg247BH4XribwIICKLHu1IUCX50nbSdmK34JniLBPzY',
              'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFmcXVjaWtldGN0ZXFxeW51Y2V0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE4NzQxODYsImV4cCI6MjA2NzQ1MDE4Nn0.Mg247BH4XribwIICKLHu1IUCX50nbSdmK34JniLBPzY'
            },
            body: JSON.stringify({
              referrer_email: ref,
              referred_email: email
            })
          });
        }

        window.location.href = "index.html";
      } else {
        alert("Registrierung fehlgeschlagen.");
      }
    }
  </script>
</body>
</html>
